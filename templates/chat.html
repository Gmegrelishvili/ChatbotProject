<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chat Page</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <style>
        body, html {
          height: 100%;
        }

        .chat-container {
          height: 100vh;
          display: flex;
          flex-direction: column;
          padding: 20px;
        }

        .chat-box {
          flex: 1;
          border: 1px solid #dee2e6;
          border-radius: 10px;
          padding: 15px;
          overflow-y: auto;
          background-color: #f8f9fa;
          margin-bottom: 15px;
        }

        .input-area {
          display: flex;
          gap: 10px;
        }

        .form-control {
          resize: none;
          min-height: 3em;
          max-height: 6em;
        }

        .btn-send {
          min-width: 100px;
        }
    </style>
</head>
<body>


<div class="container chat-container p-2">

    <div class="chat-box" id="chatBox">
        {% if current_user.is_authenticated %}
            {% for msg in messages %}
                {% if msg.is_chatbot %}
                     <p class="bg-info rounded-2 p-2 text-white w-25">{{ msg.text }}</p>
                {% else %}
                    <p class="bg-primary rounded-2 p-2 text-white w-25">{{ msg.text }}</p>
                {% endif %}
        {% endfor %}
        {% endif %}
    </div>

    <form method="post">
        {{ form.hidden_tag() }}
        <div class="row align-items-center">
            <div class="col-9">
                {% if current_user.is_authenticated %}
                    {{ form.message(class="form-control", placeholder=form.message.label.text, rows=3) }}
                {% else %}
                    <input class="form-control" type="text" placeholder="Please authenticate." disabled>
                {% endif %}
            </div>
            <div class="col-3">
                {% if current_user.is_authenticated %}
                    {{ form.submit(class="btn btn-primary w-100", style="height: 90px;") }}
                {% else %}
                    <input class="form-control" type="text" placeholder="Send" disabled>
                {% endif %}
            </div>
        </div>
    </form>

</div>

<script>
    function sendMessage(e) {
      e.preventDefault();
      const input = document.getElementById('userInput');
      const chatBox = document.getElementById('chatBox');

      const userMsg = input.value.trim();
      if (!userMsg) return;

      const userDiv = document.createElement('div');
      userDiv.className = "text-end mb-2";
      userDiv.innerHTML = `<span class="badge bg-primary">${userMsg}</span>`;
      chatBox.appendChild(userDiv);

      const botDiv = document.createElement('div');
      botDiv.className = "text-start mb-2";
      botDiv.innerHTML = `<span class="badge bg-secondary">Bot response to: ${userMsg}</span>`;
      chatBox.appendChild(botDiv);

      input.value = '';
      chatBox.scrollTop = chatBox.scrollHeight;
    }
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q"
        crossorigin="anonymous"></script>
</body>
</html>

